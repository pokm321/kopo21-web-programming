<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <style>
    #wrapper {
      position: absolute;
      overflow: hidden;
      width: 1200px;
      height: 600px;
      border: 10px solid;
    }

    #background {
      height: 600px;
      background-size: contain;
      background-image: url("https://wallpaperaccess.com/full/3739446.jpg");
      background-repeat: repeat-x;
    }

    #gameOver {
      position: absolute;
      width: 1210px;
      height: 610px;
      background-color: black;
      color: aliceblue;
      font-size: 100px;
      text-align: center;
      line-height: 610px;
      opacity: 0;
    }

    #goomba {
      position: absolute;
      width: 80px;
      left: 100px;
      top: 456px;
    }

    #fire {
      position: absolute;
      width: 50px;
      left: 120px;
      top: 480px;
      opacity: 0;
    }

    #mario {
      position: absolute;
      width: 80px;
      left: 1100px;
      top: 376px;
      transform: scaleX(-1);
    }

    #score {
      position: absolute;
      left: 350px;
      top: 50px;
      font-size: x-large;
    }

    @keyframes bg-slide {
      from {
        left: 0px;
      }

      to {
        left: -100%;
      }
    }
  </style>

  <script>
    $("body").on("keypress", function (e) {
      if (e.key == " ") {
        jump();
      } else if (e.key == "a") {
        fire();
      }
    })

    $(function () {
      FPS = 60;

      GOOMBA_JUMPING_ABILITY = 300;
      GOOMBA_FIRE_SPEED = 2000;

      FIRE_START_POINT = $("#fire").css("left");

      MARIO_START_POINT = $("#mario").css("left");
      DEFAULT_SPEED_MARIO = 1500;
      RANDOMNESS_SPEED_MARIO = 1000;

      highScore = 0;

      startGame();
    })

    function startGame() {
      score = 0;
      marioAlive = true;
      isJumping = false;

      gameFrame = setInterval(hitscan, 1000 / FPS);
      showScore();
      moveMario();
    }

    function gameOver() {
      marioAlive = false;
      clearInterval(gameFrame);

      $("#gameOver").html("Game Over<br>현재 기록: " + score + "점<br>최고 기록: " + highScore + "점").css("opacity", "1")

      startGame();
    }

    function showScore() {
      $("#score").html("최고점수: " + highScore + "점<br><br>현재점수: " + score + " 점")
    }

    function moveMario() {
      marioSpeed = (Math.random() * RANDOMNESS_SPEED_MARIO) + DEFAULT_SPEED_MARIO;
      $("#mario").animate({
        left: "-=1500px"
      }, marioSpeed, function () {
        $(this).css("left", MARIO_START_POINT);
        if (marioAlive == true) {
          score += 100;
          showScore();
          moveMario();
        }
      })
    }

    function hitscan() {
      let goombaBottom = parseInt($("#goomba").css("height")) + parseInt($("#goomba").css("top"))
      let goombaLeft = parseInt($("#goomba").css("left"))
      let goombaRight = parseInt($("#goomba").css("left")) + parseInt($("#goomba").css("width"))
      let marioTop = parseInt($("#mario").css("top"))
      let marioLeft = parseInt($("#mario").css("left"))
      let marioRight = parseInt($("#mario").css("left")) + parseInt($("#mario").css("width"))

      if (goombaBottom > marioTop && goombaRight > marioLeft && goombaLeft < marioRight) {
        gameOver();
      }
    }

    function jump() {
      if (isJumping == true) {
        return;
      }

      isJumping = true;
      $("#goomba").animate({
        top: "-=" + GOOMBA_JUMPING_ABILITY + "px"
      }).animate({
        top: "+=" + GOOMBA_JUMPING_ABILITY + "px"
      }, function () {
        isJumping = false;
      })
    }

    function fire() {
      if (isJumping == true) {
        return;
      }

      $("#fire").css("opacity", "1").animate({
        left: "+=1500px"
      }, GOOMBA_FIRE_SPEED, function () {
        $(this).css("opacity", "0").css("left", FIRE_START_POINT)
      })
    }

  </script>
  <div id="wrapper">
    <div id="background"></div>
  </div>

  <img id="fire" src="https://thumbs.gfycat.com/SlipperyObedientBasil-max-1mb.gif" alt="">
  <img id="goomba" src="https://art.pixilart.com/14153dbda06f26e.gif" alt="">
  <img id="mario" src="https://i.pinimg.com/originals/4d/1e/b2/4d1eb2fb62a71b8d3d82523e3e2b6987.gif" alt="">

  <div id="score"></div>

  <div id="gameOver"></div>
</body>

</html>